import React, { useState, useMemo } from 'react';
import { 
  Briefcase, 
  Bitcoin, 
  BarChart3, 
  Globe, 
  Plane, 
  Package, 
  Calendar,
  Wallet,
  TrendingUp,
  Store,
  PieChart
} from 'lucide-react';

// 將組件移到 App 外部定義，修復輸入一個數字就失去焦點的問題
const MiniInput = ({ label, value, icon: Icon, color, onChange, unit = "TWD" }) => (
  <div className="flex items-center gap-2 bg-white p-2 rounded-xl border border-gray-100 shadow-sm focus-within:ring-1 focus-within:ring-blue-400">
    <Icon size={14} className={color} />
    <div className="flex-1">
      <div className="text-[10px] text-gray-400 leading-none mb-1">{label}</div>
      <div className="relative flex items-center">
        <input
          type="number"
          value={value === 0 ? '' : value}
          onChange={(e) => onChange(e.target.value)}
          className={`w-full font-bold text-sm bg-transparent outline-none ${value < 0 ? 'text-red-500' : 'text-slate-700'}`}
          placeholder="0"
        />
        <span className="text-[9px] text-gray-300 ml-1 whitespace-nowrap">{unit}</span>
      </div>
    </div>
  </div>
);

const App = () => {
  const [finances, setFinances] = useState({
    main: 0, pet: 0, beauty: 0, btc: 0, tw: 0, us: 0
  });

  const [days, setDays] = useState({ work: 0, travel: 0, source: 0 });

  const handleFin = (key, val) => setFinances(p => ({ ...p, [key]: val === '' ? 0 : parseFloat(val) }));
  const handleDay = (key, val) => setDays(p => ({ ...p, [key]: val === '' ? 0 : parseInt(val) }));

  const total = useMemo(() => Object.values(finances).reduce((a, b) => a + b, 0), [finances]);
  const daily = useMemo(() => (days.work + days.source) > 0 ? total / (days.work + days.source) : 0, [total, days]);

  const fmt = (v) => new Intl.NumberFormat('zh-TW', { style: 'currency', currency: 'TWD', maximumFractionDigits: 0 }).format(v);

  return (
    <div className="h-screen bg-slate-50 flex flex-col p-3 overflow-hidden font-sans">
      {/* 頂部總覽 - 固定高度 */}
      <header className="flex items-center justify-between bg-blue-600 p-4 rounded-2xl shadow-lg text-white mb-3 flex-shrink-0">
        <div>
          <h1 className="text-xs font-bold opacity-80 uppercase tracking-widest">2025 年薪總計</h1>
          <div className="text-2xl font-black tracking-tight">{fmt(total)}</div>
        </div>
        <div className="text-right border-l border-blue-400/50 pl-4">
          <div className="text-[10px] opacity-80 font-bold uppercase">平均日薪</div>
          <div className="text-lg font-bold text-emerald-300">{fmt(daily)}</div>
        </div>
      </header>

      {/* 中間輸入區域 - 確保不超出螢幕 */}
      <div className="flex-1 grid grid-cols-2 gap-2 overflow-y-auto pb-2 content-start">
        
        {/* 營收項目 */}
        <div className="col-span-2 text-[11px] font-bold text-slate-400 px-1 mt-1 flex items-center gap-1">
          <Briefcase size={12} /> 營收追蹤 (可輸負數)
        </div>
        <MiniInput label="童裝淨毛利" value={finances.main} icon={Store} color="text-blue-500" onChange={v => handleFin('main', v)} />
        <MiniInput label="寵物展收益" value={finances.pet} icon={PieChart} color="text-orange-500" onChange={v => handleFin('pet', v)} />
        <MiniInput label="Q3美顏飲" value={finances.beauty} icon={BarChart3} color="text-pink-500" onChange={v => handleFin('beauty', v)} />
        <MiniInput label="比特幣損益" value={finances.btc} icon={Bitcoin} color="text-yellow-600" onChange={v => handleFin('btc', v)} />
        <MiniInput label="台股損益" value={finances.tw} icon={TrendingUp} color="text-green-600" onChange={v => handleFin('tw', v)} />
        <MiniInput label="美股損益" value={finances.us} icon={Globe} color="text-indigo-600" onChange={v => handleFin('us', v)} />

        {/* 時間統計 */}
        <div className="col-span-2 text-[11px] font-bold text-slate-400 px-1 mt-3 flex items-center gap-1 border-t border-slate-200 pt-3">
          <Calendar size={12} /> 時間分配
        </div>
        <MiniInput label="工作總天數" value={days.work} icon={Calendar} color="text-emerald-500" unit="天" onChange={v => handleDay('work', v)} />
        <MiniInput label="出國拿貨" value={days.source} icon={Package} color="text-amber-500" unit="天" onChange={v => handleDay('source', v)} />
        <div className="col-span-2">
          <MiniInput label="出國旅遊天數" value={days.travel} icon={Plane} color="text-cyan-500" unit="天" onChange={v => handleDay('travel', v)} />
        </div>
      </div>

      {/* 底部精簡狀態欄 */}
      <footer className="mt-2 bg-slate-800 rounded-xl p-3 text-white flex justify-between items-center flex-shrink-0">
        <div className="flex flex-col">
          <span className="text-[10px] text-slate-400 font-bold uppercase">投資/主業比</span>
          <span className="text-sm font-bold">
            {finances.main === 0 ? '0' : (( (finances.btc + finances.tw + finances.us) / finances.main ) * 100).toFixed(0)}%
          </span>
        </div>
        <div className="text-right">
          <div className="text-[10px] text-slate-500 font-medium italic">2025 Financial Tracker</div>
          <div className="text-[9px] text-slate-400 italic">Data updates in real-time</div>
        </div>
      </footer>
    </div>
  );
};

export default App;

